<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.35">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gabriel Odom">
<meta name="dcterms.date" content="2019-10-14">

<title>PHC 6701: R for Data Science - Lesson 13: Exploring Data with the Tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../about.html" rel="next">
<link href="../lessons/lesson12_purrr.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Lesson 13: Exploring Data with the Tidyverse</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">PHC 6701: R for Data Science</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson01_greater_data_science.html" class="sidebar-item-text sidebar-link">Lesson 1: Overview of Data Science</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson02_introduction_to_R.html" class="sidebar-item-text sidebar-link">Lesson 2: Introduction to R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson02s_scripts.html" class="sidebar-item-text sidebar-link">Lesson 2 Supplement: R Scripts</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson03_introduction_to_Quarto.html" class="sidebar-item-text sidebar-link">Lesson 3: Quarto for Reproducible Reports</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson04_ggplot.html" class="sidebar-item-text sidebar-link">Lesson 4: ggplot and the Layered Grammar of Graphics</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson04s_examples.html" class="sidebar-item-text sidebar-link">Lesson 4 Supplement: ggplot Examples</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson05_RStudio_projects.html" class="sidebar-item-text sidebar-link">Lesson 5: RStudio Projects</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson06_atomic_vectors.html" class="sidebar-item-text sidebar-link">Lesson 6: Atomic Vectors</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson07_lists_and_tibbles.html" class="sidebar-item-text sidebar-link">Lesson 7: Lists and Tibbles</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson08_Data_Read_Write.html" class="sidebar-item-text sidebar-link">Lesson 8: Importing Tidy Data</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson09_dplyr.html" class="sidebar-item-text sidebar-link">Lesson 9: Data Manipulation with dplyr</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson09s_dplyr_v_base.html" class="sidebar-item-text sidebar-link">Lesson 9 Supplement: Compare dplyr and base R Subsetting</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson10_stringr.html" class="sidebar-item-text sidebar-link">Lesson 10: Wrangling Character Strings with stringr</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson11_functions.html" class="sidebar-item-text sidebar-link">Lesson 11: Functions and Control Flow in R</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson12_purrr.html" class="sidebar-item-text sidebar-link">Lesson 12: Functional Iteration with purrr</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/lesson13_eda_w_tidyverse.html" class="sidebar-item-text sidebar-link active">Lesson 13: Exploring Data with the Tidyverse</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">About</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#review" id="toc-review" class="nav-link active" data-scroll-target="#review">Review</a></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#reading-videos-and-assignments" id="toc-reading-videos-and-assignments" class="nav-link" data-scroll-target="#reading-videos-and-assignments">Reading, Videos, and Assignments</a></li>
  </ul></li>
  <li><a href="#importing-data" id="toc-importing-data" class="nav-link" data-scroll-target="#importing-data">Importing Data</a>
  <ul class="collapse">
  <li><a href="#the-raw-data" id="toc-the-raw-data" class="nav-link" data-scroll-target="#the-raw-data">The Raw Data</a></li>
  <li><a href="#read-the-data" id="toc-read-the-data" class="nav-link" data-scroll-target="#read-the-data">Read the Data</a></li>
  </ul></li>
  <li><a href="#review-basic-string-functions" id="toc-review-basic-string-functions" class="nav-link" data-scroll-target="#review-basic-string-functions">Review: Basic String Functions</a>
  <ul class="collapse">
  <li><a href="#detecting-strings" id="toc-detecting-strings" class="nav-link" data-scroll-target="#detecting-strings">Detecting Strings</a></li>
  <li><a href="#string-cases" id="toc-string-cases" class="nav-link" data-scroll-target="#string-cases">String Cases</a></li>
  </ul></li>
  <li><a href="#sanity-checks" id="toc-sanity-checks" class="nav-link" data-scroll-target="#sanity-checks">Sanity Checks</a>
  <ul class="collapse">
  <li><a href="#find-the-food-stamps-metric" id="toc-find-the-food-stamps-metric" class="nav-link" data-scroll-target="#find-the-food-stamps-metric">Find the “Food Stamps” Metric</a></li>
  <li><a href="#find-the-income-metric" id="toc-find-the-income-metric" class="nav-link" data-scroll-target="#find-the-income-metric">Find the “Income” Metric</a></li>
  <li><a href="#subset-and-mutate-the-data" id="toc-subset-and-mutate-the-data" class="nav-link" data-scroll-target="#subset-and-mutate-the-data">Subset and Mutate the Data</a></li>
  <li><a href="#plotting-the-relationship" id="toc-plotting-the-relationship" class="nav-link" data-scroll-target="#plotting-the-relationship">Plotting the Relationship</a></li>
  </ul></li>
  <li><a href="#generating-hypotheses" id="toc-generating-hypotheses" class="nav-link" data-scroll-target="#generating-hypotheses">Generating Hypotheses</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Lesson 13: Exploring Data with the Tidyverse</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gabriel Odom </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 14, 2019</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="review" class="level1">
<h1>Review</h1>
<p>What have we learned so far this semester?</p>
<ol type="1">
<li>Writing reports with Quarto</li>
<li>Plots with <code>ggplot2</code></li>
<li>Vectors</li>
<li>Importing and wrangling data with <code>readr</code>, <code>tibble</code>, and <code>dplyr</code></li>
<li>Manipulating strings with <code>stringr</code></li>
<li>Writing functions and applying them with <code>purrr</code></li>
</ol>
<p><br></p>
<hr>
<p><br></p>
</section>
<section id="overview" class="level1">
<h1>Overview</h1>
<p>In this lesson, we will combine all of the skills we have learned so far to explore data with the Tidyverse. In terms of “new” content, this lesson is shorter, but that is to leave plenty of time to work on the homework at the end of this lesson.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="reading-videos-and-assignments" class="level2">
<h2 class="anchored" data-anchor-id="reading-videos-and-assignments">Reading, Videos, and Assignments</h2>
<ul>
<li>Watch: <a href="https://www.youtube.com/playlist?list=PLHKz7LkI0oR1bwDUxzAc57JB2HdJ03V_o" class="uri">https://www.youtube.com/playlist?list=PLHKz7LkI0oR1bwDUxzAc57JB2HdJ03V_o</a></li>
<li>Read:</li>
<li>Do:</li>
</ul>
<p><br></p>
<hr>
<p><br></p>
</section>
</section>
<section id="importing-data" class="level1">
<h1>Importing Data</h1>
<p>We will work through some of the <a href="https://www.census.gov/programs-surveys/acs">American Community Survey</a> data from the U.S. Census Bureau. If you have not yet done so, download the ACS “food stamps” data (“FOOD STAMPS/Supplemental Nutrition Assistance Program (SNAP) American Community Survey 5-Year Estimates”) for 2021 (use the steps we worked out in Lesson 08).</p>
<section id="the-raw-data" class="level2">
<h2 class="anchored" data-anchor-id="the-raw-data">The Raw Data</h2>
<p><em>You should have already downloaded the raw data in lesson 8.</em> However, if you did not complete that exercise, download the data and metadata <a href="https://github.com/gabrielodom/PHC6701_r4ds/tree/main/_data">from the GitHub repository for this class</a>. You should have a metadata file called <code>ACSST5Y2021.S2201-Column-Metadata.csv</code> which explains all the variable names and a data file called <code>ACSST5Y2021.S2201-Data.csv</code> that contains some of the features of interest.</p>
</section>
<section id="read-the-data" class="level2">
<h2 class="anchored" data-anchor-id="read-the-data">Read the Data</h2>
<p>Now that you have raw data files, import them into R (you will have to update the path to these data sets based on how you saved these files on your computer). ACS data files often have more than one row of column names (the first row is a unique ID for the column, and sometimes the next 1-2 rows are metadata about the column). In our case, we have character information we don’t want at the tops of our columns, so we will import the column names first, then import the data.</p>
<section id="snap-data-values" class="level3">
<h3 class="anchored" data-anchor-id="snap-data-values">SNAP Data Values</h3>
<p>We first define a path to our data values (remember to update this to match your machine), then we import only the column headers for this data (that’s the <code>n_max = 0</code> part). After we have the names we want, we can import the rest of the data—skipping the first two rows—but using the names we calculated in the step before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_path <span class="ot">&lt;-</span> <span class="st">"../_data/ACSST5Y2021_S2201/ACSST5Y2021.S2201-Data.csv"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>colNames_char <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">read_csv</span>(data_path, <span class="at">n_max =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 0 Columns: 459
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(459): GEO_ID, NAME, S2201_C01_001E, S2201_C01_001M, S2201_C01_002E, S22...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...459`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>FLallZIP_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> data_path,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> colNames_char,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">2</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1013 Columns: 459
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (236): GEO_ID, NAME, S2201_C01_034E, S2201_C01_034M, S2201_C02_001E, S22...
dbl (222): S2201_C01_001E, S2201_C01_001M, S2201_C01_002E, S2201_C01_002M, S...
lgl   (1): ...459

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>The meta-data doesn’t need those tricks. We can import it as is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>FLmetadata_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">"../_data/ACSST5Y2021_S2201/ACSST5Y2021.S2201-Column-Metadata.csv"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 458 Columns: 2
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (2): Column Name, Label

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
</section>
<section id="inspect-data-sets" class="level3">
<h3 class="anchored" data-anchor-id="inspect-data-sets">Inspect Data Sets</h3>
<p>Let’s get an idea of what is in these data sets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>FLallZIP_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,013 × 459
   GEO_ID      NAME  S2201_C01_001E S2201_C01_001M S2201_C01_002E S2201_C01_002M
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;
 1 860Z200US3… ZCTA…          11090            672           5276            611
 2 860Z200US3… ZCTA…           2354            378           1300            272
 3 860Z200US3… ZCTA…           1383            231            574            106
 4 860Z200US3… ZCTA…           5480            430           2172            294
 5 860Z200US3… ZCTA…              5             11              5             11
 6 860Z200US3… ZCTA…           7220            403           3636            322
 7 860Z200US3… ZCTA…           8127            544           3524            323
 8 860Z200US3… ZCTA…              0             14              0             14
 9 860Z200US3… ZCTA…           1915            425           1096            177
10 860Z200US3… ZCTA…          16526            728           9846            654
# ℹ 1,003 more rows
# ℹ 453 more variables: S2201_C01_003E &lt;dbl&gt;, S2201_C01_003M &lt;dbl&gt;,
#   S2201_C01_004E &lt;dbl&gt;, S2201_C01_004M &lt;dbl&gt;, S2201_C01_005E &lt;dbl&gt;,
#   S2201_C01_005M &lt;dbl&gt;, S2201_C01_006E &lt;dbl&gt;, S2201_C01_006M &lt;dbl&gt;,
#   S2201_C01_007E &lt;dbl&gt;, S2201_C01_007M &lt;dbl&gt;, S2201_C01_008E &lt;dbl&gt;,
#   S2201_C01_008M &lt;dbl&gt;, S2201_C01_009E &lt;dbl&gt;, S2201_C01_009M &lt;dbl&gt;,
#   S2201_C01_010E &lt;dbl&gt;, S2201_C01_010M &lt;dbl&gt;, S2201_C01_011E &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>There are 457 columns of information (459 - 2 index columns), and it looks like all of these columns have bizarre codes for their names.</p>
<p>Now for the metadata:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>FLmetadata_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 458 × 2
   `Column Name`  Label                                                         
   &lt;chr&gt;          &lt;chr&gt;                                                         
 1 GEO_ID         Geography                                                     
 2 NAME           Geographic Area Name                                          
 3 S2201_C01_001E Estimate!!Total!!Households                                   
 4 S2201_C01_001M Margin of Error!!Total!!Households                            
 5 S2201_C01_002E Estimate!!Total!!Households!!With one or more people in the h…
 6 S2201_C01_002M Margin of Error!!Total!!Households!!With one or more people i…
 7 S2201_C01_003E Estimate!!Total!!Households!!No people in the household 60 ye…
 8 S2201_C01_003M Margin of Error!!Total!!Households!!No people in the househol…
 9 S2201_C01_004E Estimate!!Total!!Households!!Married-couple family            
10 S2201_C01_004M Margin of Error!!Total!!Households!!Married-couple family     
# ℹ 448 more rows</code></pre>
</div>
</div>
<p>The first column of this data looks exactly like the crazy column names of the main data set. This information should allow us to find out what the column codes mean.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body" title="Exercise">
<p>Spend some time looking through the columns of this dataset and their classes. Many of the columns are numeric and many are character; some columns that are character shouldn’t be. Discuss this with your neighbours and think about solutions to figure out how to detect columns that should be numeric but are not.</p>
</div>
</div>
</section>
<section id="updated-summary-function" class="level3">
<h3 class="anchored" data-anchor-id="updated-summary-function">Updated Summary Function</h3>
<p>Recall our lesson on functions last week. Based on this lesson, we are able to write an updated version of the <code>summary()</code> function. Our summary function should print the most common unique values for character information, but call the <code>summary()</code> function as normal for anything else:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>MySummary <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(x)){</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">table</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">head</span>()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(x)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="apply-to-the-raw-data" class="level3">
<h3 class="anchored" data-anchor-id="apply-to-the-raw-data">Apply to the Raw Data</h3>
<p>Now that we have an updated function to take summaries of a tibble across the columns, let’s apply it to each column of the data (because this will print almost 500 results, we will apply this function to a random set of 50 columns as an example):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The first two columns are ZIP codes and geography IDs</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>randColumns_idx <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample</span>(<span class="dv">3</span><span class="sc">:</span><span class="fu">ncol</span>(FLallZIP_df), <span class="at">size =</span> <span class="dv">50</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(FLallZIP_df[, randColumns_idx], MySummary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$S2201_C01_006M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    5.0    64.0   141.0   159.3   227.0   715.0 

$S2201_C01_007M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    2.0   109.0   220.0   235.8   337.0   959.0 

$S2201_C01_008M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    6.0   199.0   392.0   384.2   541.0  1272.0 

$S2201_C01_013E
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   107.0   397.0   599.2   877.0  4735.0 

$S2201_C01_018M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    4.0    35.0    86.0   104.4   146.0   672.0 

$S2201_C01_019M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    5.0    67.0   133.0   151.1   214.0   725.0 

$S2201_C01_020M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    6.0   198.0   389.0   382.9   541.0  1272.0 

$S2201_C01_026E
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0      71     370    1103    1251   18704 

$S2201_C01_030M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    3.0    22.0    78.0   111.9   161.0   629.0 

$S2201_C01_031M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    2.0    57.0   154.0   204.1   293.0  1084.0 

$S2201_C01_038E
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      0     624    2028    2496    3744   12111 

$S2201_C02_002M
x
3.3  ** 3.4 3.5 2.8 3.2 
 38  33  33  32  31  30 

$S2201_C02_005M
x
3.0 3.2  ** 2.5 2.6 2.8 
 34  34  33  32  31  29 

$S2201_C02_009E
x
   -  0.0 25.2 20.5 22.5 24.0 
  33   24   11    7    7    7 

$S2201_C02_014E
x
0.0 0.1 0.2 0.3 0.4   - 
475 121  97  81  58  33 

$S2201_C02_015M
x
3.1  ** 2.9 3.2 3.3 2.8 
 36  33  33  33  32  28 

$S2201_C02_024E
x
    - 100.0  78.8  69.0  74.1  74.9 
   33    17     9     8     8     8 

$S2201_C02_031E
x
0.0   - 3.4 3.0 2.3 3.5 
 73  33  20  18  15  15 

$S2201_C02_033E
x
    - 100.0   0.0  85.3  77.3  83.2 
   33    33     6     6     5     5 

$S2201_C02_033M
x
3.5 3.7  ** 2.9 3.2 3.0 
 37  36  33  33  32  31 

$S2201_C02_036M
x
 ** 3.1 3.7 3.4 2.8 3.6 
 38  28  27  25  24  21 

$S2201_C02_038M
x
 ** 5.0 4.1 4.5 4.7 3.9 
 38  28  25  25  24  23 

$S2201_C03_007M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    3.0    42.0   106.0   132.8   192.0   603.0 

$S2201_C03_020M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    4.0    40.0    96.0   119.6   171.0   568.0 

$S2201_C03_028M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   2.00   14.00   23.00   28.65   30.00  266.00 

$S2201_C03_030E
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    0.00    7.00   58.42   63.00 1076.00 

$S2201_C03_030M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   3.00   17.00   25.00   50.47   60.00  568.00 

$S2201_C03_032M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      3      22      68     120     173     795 

$S2201_C03_033M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    5.0    57.0   118.0   130.6   185.0   606.0 

$S2201_C03_034M
x
   **   *** 12937  3422  5566  6141 
  223     2     2     2     2     2 

$S2201_C04_002M
x
   **   9.8  12.6   8.4 100.0  10.1 
   81    15    12    11    10     9 

$S2201_C04_015E
x
    - 100.0   0.0  60.2  48.9  45.5 
   81    36     9     8     7     5 

$S2201_C04_015M
x
  ** 10.3 13.4 11.5 11.2 11.3 
  81   12   11   10    9    9 

$S2201_C04_016E
x
 0.0    -  6.9 12.1  6.7  7.5 
  92   81   10    9    9    9 

$S2201_C04_019M
x
 ** 4.5 3.7 5.3 4.1 4.6 
 81  17  16  15  13  13 

$S2201_C04_029M
x
 ** 1.8 1.1 1.9 1.5 1.7 
 81  17  16  14  13  13 

$S2201_C04_030M
x
 ** 3.6 4.5 2.7 2.9 2.1 
 81  13  13  12  12  11 

$S2201_C04_033M
x
   **  10.8 100.0   8.1  16.5  10.2 
   81    10    10    10     9     8 

$S2201_C05_005M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    2.0   113.0   226.0   241.5   343.0  1152.0 

$S2201_C05_012M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   2.00   34.00   81.00   98.49  141.00  479.00 

$S2201_C05_023M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    3.0   161.0   278.0   288.6   401.0  1050.0 

$S2201_C05_024M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    6.0   267.0   487.0   474.8   654.0  1448.0 

$S2201_C05_025M
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    6.0   252.0   457.0   434.5   595.0  1337.0 

$S2201_C05_029E
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  0.000   0.000   0.000   3.098   0.000 121.000 

$S2201_C05_036E
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    0.0   235.0   651.0   859.6  1175.0 14985.0 

$S2201_C06_005E
x
 0.0    - 11.3 10.7 12.7  8.5 
  36   35   12   11   11   11 

$S2201_C06_007E
x
0.0   - 6.2 8.3 8.0 3.7 
 47  35  19  16  15  13 

$S2201_C06_018M
x
0.8 0.9 1.0 1.1 1.4 1.2 
 67  60  57  53  53  51 

$S2201_C06_022E
x
100.0     -  91.6  92.8  92.7  91.3 
   39    35    15    15    13    12 

$S2201_C06_035E
 (X) 
1013 </code></pre>
</div>
</div>
<p>It looks like many of these columns (such as <code>S2201_C02_002M</code> or <code>S2201_C06_022E</code>) have numeric data stored as character information, probably because the symbols <code>"-"</code>, <code>"**"</code>, and <code>"***"</code> are used in some columns. From my experience, these symbols mark various types of missing data.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body" title="Exercise">
<p>Find out what these symbols mean. Where should you look? Write the definitions of these symbols as comments in your analysis script, and state the source of this information.</p>
</div>
</div>
<p>If we were planning to perform an analysis of all these features, then we should write code to go through these columns to 1) replace the <code>"-"</code> and <code>"**"</code> with <code>NA_real_</code>, and 2) transform these columns to numeric. However, we only need a few columns from this data set. Therefore, we will fix these issues only for the columns we need (after we find out what those columns are).</p>
<p><br></p>
<hr>
<p><br></p>
</section>
</section>
</section>
<section id="review-basic-string-functions" class="level1">
<h1>Review: Basic String Functions</h1>
<p>Because the column name look-up table and many of the data columns contain character information, we need to review a few basic functions from the <code>stringr</code> package (included in the <code>tidyverse</code>).</p>
<section id="detecting-strings" class="level2">
<h2 class="anchored" data-anchor-id="detecting-strings">Detecting Strings</h2>
<p>From looking at the columns in the metadata table, it would probably be helpful to find if a word or phrase is contained in a character string. This is the function of <code>str_detect()</code>. As an example, let’s see if any of the features are specific to Hispanic households:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>FLmetadata_df <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Label) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(<span class="at">pattern =</span> <span class="st">"Hispanic"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.
FALSE  TRUE 
  434    24 </code></pre>
</div>
</div>
<p>As we can see, this function returns a logical vector indicating if the string <code>"Hispanic"</code> is in the elements of the <code>Label</code> column, then the <code>table()</code> function tells us this information is present in only a handful of the columns. By itself, this isn’t helpful: we don’t know what the strings are, and we certainly don’t know which rows of the tibble they belong to. But at least we know that we have some data on Hispanic households.</p>
<p>To solve these problems, we combine <code>str_detect()</code> with <code>mutate()</code> and <code>filter()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>FLmetadata_df <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hispanic_logi =</span> <span class="fu">str_detect</span>(Label, <span class="st">"Hispanic"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Hispanic_logi) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Hispanic_logi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 2
   `Column Name`  Label                                                         
   &lt;chr&gt;          &lt;chr&gt;                                                         
 1 S2201_C01_032E Estimate!!Total!!Households!!RACE AND HISPANIC OR LATINO ORIG…
 2 S2201_C01_032M Margin of Error!!Total!!Households!!RACE AND HISPANIC OR LATI…
 3 S2201_C01_033E Estimate!!Total!!Households!!RACE AND HISPANIC OR LATINO ORIG…
 4 S2201_C01_033M Margin of Error!!Total!!Households!!RACE AND HISPANIC OR LATI…
 5 S2201_C02_032E Estimate!!Percent!!Households!!RACE AND HISPANIC OR LATINO OR…
 6 S2201_C02_032M Margin of Error!!Percent!!Households!!RACE AND HISPANIC OR LA…
 7 S2201_C02_033E Estimate!!Percent!!Households!!RACE AND HISPANIC OR LATINO OR…
 8 S2201_C02_033M Margin of Error!!Percent!!Households!!RACE AND HISPANIC OR LA…
 9 S2201_C03_032E Estimate!!Households receiving food stamps/SNAP!!Households!!…
10 S2201_C03_032M Margin of Error!!Households receiving food stamps/SNAP!!House…
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>This is a very nice result: we used the <code>mutate()</code> function to add a column of <code>TRUE</code> or <code>FALSE</code> values to the data frame to indicate if <code>"Hispanic"</code> was present in the column names (in the <code>Label</code> column). Then, we selected all of the rows where this indicator was <code>TRUE</code>, and then removed the indicator (because we no longer needed it).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercises
</div>
</div>
<div class="callout-body-container callout-body" title="Exercises">
<ol type="1">
<li>I explained the code above in a short paragraph after the code. Is this the best way? (<em>Hint: think about how we document functions and why.</em>) Can you add a few comments to the code itself to explain what each line is doing?</li>
<li>Try to find “HISPANIC” and “hispanic”. What can we do to modify the metadata so that one search will find all the rows we might want?</li>
<li>Many of the rows in the meta-data are not going to be any use to use at all. Can you brainstorm a <code>stringr::</code> pipeline that will clean up the meta-data table to make it easier for us to go through?</li>
</ol>
</div>
</div>
</section>
<section id="string-cases" class="level2">
<h2 class="anchored" data-anchor-id="string-cases">String Cases</h2>
<p>Because R is case sensitive, the string <code>"Hispanic"</code> and <code>"HISPANIC"</code> are not the same. We can use the <code>str_to_upper()</code> and <code>str_to_lower()</code> functions to convert all of the string data to the same case (so our searches don’t fail). In this case, we have to make sure to save the new tibble:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>FLmetadata2_df <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  FLmetadata_df <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Label =</span> <span class="fu">str_to_lower</span>(Label))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Did it work?</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>FLmetadata2_df <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hispanic_logi =</span> <span class="fu">str_detect</span>(Label, <span class="st">"hispanic"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Hispanic_logi) <span class="sc">%&gt;%</span> </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Hispanic_logi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 108 × 2
   `Column Name`  Label                                                         
   &lt;chr&gt;          &lt;chr&gt;                                                         
 1 S2201_C01_025E estimate!!total!!households!!race and hispanic or latino orig…
 2 S2201_C01_025M margin of error!!total!!households!!race and hispanic or lati…
 3 S2201_C01_026E estimate!!total!!households!!race and hispanic or latino orig…
 4 S2201_C01_026M margin of error!!total!!households!!race and hispanic or lati…
 5 S2201_C01_027E estimate!!total!!households!!race and hispanic or latino orig…
 6 S2201_C01_027M margin of error!!total!!households!!race and hispanic or lati…
 7 S2201_C01_028E estimate!!total!!households!!race and hispanic or latino orig…
 8 S2201_C01_028M margin of error!!total!!households!!race and hispanic or lati…
 9 S2201_C01_029E estimate!!total!!households!!race and hispanic or latino orig…
10 S2201_C01_029M margin of error!!total!!households!!race and hispanic or lati…
# ℹ 98 more rows</code></pre>
</div>
</div>
<p>We certainly found more rows this time!</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
“Saving” your work
</div>
</div>
<div class="callout-body-container callout-body">
<p>When working with strings, <strong>DO NOT</strong> write the new object into the container holding the old object (don’t “overwrite” your data). Strings are incredibly difficult to work with at times, so make sure you can always go back a few steps. This is why I saved the new look-up table with a different name. Personally, I usually append a number to the name of the object when I’m working with strings; then, when I’m sure I have done all the string clean-up I need, I save it with a better name and use <code>rm()</code> to remove the intermediate steps I no longer need.</p>
</div>
</div>
<p>In the dictionary/look-up table, we have all the information necessary to find the columns we want. However, before we dig into the look-up table, we notice that all of the rows are copied twice: one for estimate, and one for margin of error. For now, we aren’t interested in the margins of error, so let’s remove these rows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>FLmetadata3_df <span class="ot">&lt;-</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  FLmetadata2_df <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MOE =</span> <span class="fu">str_detect</span>(Label, <span class="st">"margin of error"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>MOE) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>MOE)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>FLmetadata3_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 230 × 2
   `Column Name`  Label                                                         
   &lt;chr&gt;          &lt;chr&gt;                                                         
 1 GEO_ID         geography                                                     
 2 NAME           geographic area name                                          
 3 S2201_C01_001E estimate!!total!!households                                   
 4 S2201_C01_002E estimate!!total!!households!!with one or more people in the h…
 5 S2201_C01_003E estimate!!total!!households!!no people in the household 60 ye…
 6 S2201_C01_004E estimate!!total!!households!!married-couple family            
 7 S2201_C01_005E estimate!!total!!households!!other family:                    
 8 S2201_C01_006E estimate!!total!!households!!other family:!!male householder,…
 9 S2201_C01_007E estimate!!total!!households!!other family:!!female householde…
10 S2201_C01_008E estimate!!total!!households!!nonfamily households             
# ℹ 220 more rows</code></pre>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercises
</div>
</div>
<div class="callout-body-container callout-body" title="Exercises">
<ol type="1">
<li>The meta-data table has information on whether the number is an estimate of the raw count (<code>total!!</code>) or an estimate of the population proportion (<code>percent!!</code>). Use <code>stringr::</code> functions to remove this information from the “Label” column and add it to its own column.</li>
<li>Can you easily break the “Label” column into any other pieces without losing information?</li>
</ol>
</div>
</div>
<p><br></p>
<hr>
<p><br></p>
</section>
</section>
<section id="sanity-checks" class="level1">
<h1>Sanity Checks</h1>
<p>Often we have some idea of a pre-existing relationship in the data; e.g, we know that there should be a clear negative relationship between food stamp use and household income within a ZIP code. If our data does not show something we know to be true, then we check that we have the right data and that we are reading the data dictionary correctly.</p>
<section id="find-the-food-stamps-metric" class="level2">
<h2 class="anchored" data-anchor-id="find-the-food-stamps-metric">Find the “Food Stamps” Metric</h2>
<p>We will use the same process as above (<code>mutate()</code> + <code>str_detect()</code> + <code>filter()</code>) to find all the columns that measure food stamp usage as a percentage:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>FLmetadata3_df <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">foodStamps_logi =</span> <span class="fu">str_detect</span>(Label, <span class="st">"food stamps"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent_logi =</span> <span class="fu">str_detect</span>(Label, <span class="st">"percent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(foodStamps_logi <span class="sc">&amp;</span> percent_logi) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>foodStamps_logi, <span class="sc">-</span>percent_logi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 2
   `Column Name`  Label                                                         
   &lt;chr&gt;          &lt;chr&gt;                                                         
 1 S2201_C04_001E estimate!!percent households receiving food stamps/snap!!hous…
 2 S2201_C04_002E estimate!!percent households receiving food stamps/snap!!hous…
 3 S2201_C04_003E estimate!!percent households receiving food stamps/snap!!hous…
 4 S2201_C04_004E estimate!!percent households receiving food stamps/snap!!hous…
 5 S2201_C04_005E estimate!!percent households receiving food stamps/snap!!hous…
 6 S2201_C04_006E estimate!!percent households receiving food stamps/snap!!hous…
 7 S2201_C04_007E estimate!!percent households receiving food stamps/snap!!hous…
 8 S2201_C04_008E estimate!!percent households receiving food stamps/snap!!hous…
 9 S2201_C04_009E estimate!!percent households receiving food stamps/snap!!hous…
10 S2201_C04_010E estimate!!percent households receiving food stamps/snap!!hous…
# ℹ 66 more rows</code></pre>
</div>
</div>
<p>While there are 76 options, it looks like we want the one labelled <code>S2201_C04_001E</code>, but the tibble print options cut off the full label. Let’s use <code>pull()</code> to extract the label and confirm it’s what we want, but note that we have to surround column names with spaces with backticks:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>FLmetadata3_df <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Column Name</span><span class="st">`</span> <span class="sc">==</span> <span class="st">"S2201_C04_001E"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "estimate!!percent households receiving food stamps/snap!!households"</code></pre>
</div>
</div>
<p>That label is correct, so let’s save this column ID.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>foodStampsColID_char <span class="ot">&lt;-</span> <span class="st">"S2201_C04_001E"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="find-the-income-metric" class="level2">
<h2 class="anchored" data-anchor-id="find-the-income-metric">Find the “Income” Metric</h2>
<p>Just like we found the column name of the food stamps metric we needed, we can find the column name for income (I recommend using the <code>View()</code> function interactively to make sure you can read the labels):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>FLmetadata3_df <span class="sc">%&gt;%</span>  </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income_logi =</span> <span class="fu">str_detect</span>(Label, <span class="st">"income"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(income_logi) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>income_logi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  `Column Name`  Label                                                          
  &lt;chr&gt;          &lt;chr&gt;                                                          
1 S2201_C01_034E estimate!!total!!households!!household income in the past 12 m…
2 S2201_C02_034E estimate!!percent!!households!!household income in the past 12…
3 S2201_C03_034E estimate!!households receiving food stamps/snap!!households!!h…
4 S2201_C04_034E estimate!!percent households receiving food stamps/snap!!house…
5 S2201_C05_034E estimate!!households not receiving food stamps/snap!!household…
6 S2201_C06_034E estimate!!percent households not receiving food stamps/snap!!h…</code></pre>
</div>
</div>
<p>These labels are too long, so we need to “pull” them out of the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>FLmetadata3_df <span class="sc">%&gt;%</span>  </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income_logi =</span> <span class="fu">str_detect</span>(Label, <span class="st">"income"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(income_logi) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>income_logi) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "estimate!!total!!households!!household income in the past 12 months (in 2021 inflation-adjusted dollars)!!median income (dollars)"                                            
[2] "estimate!!percent!!households!!household income in the past 12 months (in 2021 inflation-adjusted dollars)!!median income (dollars)"                                          
[3] "estimate!!households receiving food stamps/snap!!households!!household income in the past 12 months (in 2021 inflation-adjusted dollars)!!median income (dollars)"            
[4] "estimate!!percent households receiving food stamps/snap!!households!!household income in the past 12 months (in 2021 inflation-adjusted dollars)!!median income (dollars)"    
[5] "estimate!!households not receiving food stamps/snap!!households!!household income in the past 12 months (in 2021 inflation-adjusted dollars)!!median income (dollars)"        
[6] "estimate!!percent households not receiving food stamps/snap!!households!!household income in the past 12 months (in 2021 inflation-adjusted dollars)!!median income (dollars)"</code></pre>
</div>
</div>
<p>Because our sanity check is “ZIP codes with higher income should have lower percentages of food stamp recipients”, we want the most basic income measurement (the first one). Let’s pull the column ID for that first match:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>incomeColID_char <span class="ot">&lt;-</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  FLmetadata3_df <span class="sc">%&gt;%</span>  </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income_logi =</span> <span class="fu">str_detect</span>(Label, <span class="st">"income"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(income_logi) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">Column Name</span><span class="st">`</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>FLmetadata3_df <span class="sc">%&gt;%</span> </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Column Name</span><span class="st">`</span> <span class="sc">==</span> incomeColID_char) <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "estimate!!total!!households!!household income in the past 12 months (in 2021 inflation-adjusted dollars)!!median income (dollars)"</code></pre>
</div>
</div>
<p>Now that we have the two columns we care about, we can subset the SNAP values data to include only the following columns:</p>
<ul>
<li>ZIP code (technically the <a href="https://www.census.gov/programs-surveys/geography/guidance/geo-areas/zctas.html">ZCTA</a>),</li>
<li>proportion of households receiving food stamps in that area, and</li>
<li>the median household income for that area.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>FLallZIP_df <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">zcta =</span> NAME,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # OLD version:</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># food_stamp_prop = foodStampsColID_char,</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># median_household_income = incomeColID_char</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # New version:</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">food_stamp_prop =</span> <span class="fu">all_of</span>(foodStampsColID_char),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_household_income =</span> <span class="fu">all_of</span>(incomeColID_char)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,013 × 3
   zcta        food_stamp_prop median_household_income
   &lt;chr&gt;       &lt;chr&gt;           &lt;chr&gt;                  
 1 ZCTA5 32003 3.1             103019                 
 2 ZCTA5 32008 18.3            42802                  
 3 ZCTA5 32009 8.8             65850                  
 4 ZCTA5 32011 13.3            67087                  
 5 ZCTA5 32013 100.0           -                      
 6 ZCTA5 32024 14.8            57636                  
 7 ZCTA5 32025 19.7            47439                  
 8 ZCTA5 32026 -               -                      
 9 ZCTA5 32033 8.7             71360                  
10 ZCTA5 32034 7.3             87047                  
# ℹ 1,003 more rows</code></pre>
</div>
</div>
<p>NOTE: after I wrote this lesson, the Tidyverse developers modified how the <code>select()</code> function works. We should now use the <code>all_of()</code> helper functions. I included the original way (which now causes warnings), but I commented it out.</p>
</section>
<section id="subset-and-mutate-the-data" class="level2">
<h2 class="anchored" data-anchor-id="subset-and-mutate-the-data">Subset and Mutate the Data</h2>
<p>Notice that the atomic classes of the <code>food_stamp_prop</code> and <code>median_household_income</code> columns are both character. We see that some of the values are “missing” (as shown by the <code>"-"</code> symbol). Subsequently, it looks like have numeric information stored in character columns because a letter or symbol was used instead of <code>NA</code>. For atomic data, we can follow the type conversion rules to demote this character information to numeric (which triggers a warning):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>incomeSNAP_df <span class="ot">&lt;-</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  FLallZIP_df <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">zcta =</span> NAME,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">food_stamp_prop =</span> <span class="fu">all_of</span>(foodStampsColID_char),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_household_income =</span> <span class="fu">all_of</span>(incomeColID_char)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># drop character to numeric</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">food_stamp_prop =</span> <span class="fu">as.numeric</span>(food_stamp_prop),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_household_income =</span> <span class="fu">as.numeric</span>(median_household_income)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `food_stamp_prop = as.numeric(food_stamp_prop)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>incomeSNAP_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,013 × 3
   zcta        food_stamp_prop median_household_income
   &lt;chr&gt;                 &lt;dbl&gt;                   &lt;dbl&gt;
 1 ZCTA5 32003             3.1                  103019
 2 ZCTA5 32008            18.3                   42802
 3 ZCTA5 32009             8.8                   65850
 4 ZCTA5 32011            13.3                   67087
 5 ZCTA5 32013           100                        NA
 6 ZCTA5 32024            14.8                   57636
 7 ZCTA5 32025            19.7                   47439
 8 ZCTA5 32026            NA                        NA
 9 ZCTA5 32033             8.7                   71360
10 ZCTA5 32034             7.3                   87047
# ℹ 1,003 more rows</code></pre>
</div>
</div>
<p>Notice that the <code>"-"</code> symbols were replaced by <code>NA</code> values. (<em>If you have other features to control for or to add to the plot, make sure you include them here.</em>)</p>
</section>
<section id="plotting-the-relationship" class="level2">
<h2 class="anchored" data-anchor-id="plotting-the-relationship">Plotting the Relationship</h2>
<p>Finally, we have data we can plot!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> incomeSNAP_df) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> median_household_income, <span class="at">y =</span> food_stamp_prop) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lesson13_eda_w_tidyverse_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This clearly shows a negative relationship between income and proportion of residents on food stamps. However, the x-axis shows a strong tail, so let’s try to clean this up with a log transformation. I add the log labels automatically using the <code>label_number()</code> function from the <code>scales::</code> package (this is installed automatically when you install the Tidyverse, but I haven’t loaded it with the <code>library()</code> command, so I have to type the name of the package explicitly). Also, the relationship looks non-linear, so I’ve added a LOESS estimate in blue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> incomeSNAP_df) <span class="sc">+</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> median_household_income, <span class="at">y =</span> food_stamp_prop) <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lesson13_eda_w_tidyverse_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you need to use one function one time from a package that you have installed on your computer, you can use the <code>&lt;packName&gt;::&lt;funName&gt;</code> syntax. In the code above, I didn’t want to load the entire <code>scales</code> package for a function I’ll use only once, so I used <code>scales::label_number()</code> instead.</p>
</div>
</div>
<p>In practice, at this point we would thoroughly inspect all of the features of interest, <em>and</em> plot their relationships with the outcomes of interest. However, we don’t have time to do this in class.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercises
</div>
</div>
<div class="callout-body-container callout-body" title="Exercises">
<ol type="1">
<li>Why did I turn off the error bands for the LOESS smoother? Discuss with one of the statistics / biostatistics students (<em>HINT: think about the assumptions of regression</em>).</li>
<li>Import the ZIP code data for Miami-Dade and Broward counties. If you want, you can go find the Palm Beach county ZIP code data too.</li>
<li>Merge these two county tibbles, and clean up the ZIP code column (if you haven’t already done this as part of your homework from Lessons 8 and 10).</li>
<li>Use a <code>*_join()</code> function to create a single subset of the 2021 ACS SNAP data set with a “South Florida” indicator column that marks if the ZIP code belongs to one of these two (or three) counties.</li>
<li>Re-build your plot of this relationship, adding a color to indicate the ZIP codes in Miami-Dade and Broward (and Palm Beach?) counties. Do you see any differences between the relationship between food stamp usage and median income for the ZIP codes in our counties vs the whole state?</li>
</ol>
</div>
</div>
<p><br></p>
<hr>
<p><br></p>
</section>
</section>
<section id="generating-hypotheses" class="level1">
<h1>Generating Hypotheses</h1>
<p>Based on the above graph, there is a strong relationship between income and the proportion of food stamp recipients in a ZIP code, but it isn’t perfect. There are clearly some other factors. This is where generating hypotheses comes in.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercises
</div>
</div>
<div class="callout-body-container callout-body" title="Exercises">
<ol type="1">
<li>Work in groups of 3-4 to generate 8-10 hypotheses to explain the excess variability in the relationship between income and percentage of food stamp recipients within a ZIP code. Include at least 2 multiple-predictor hypotheses (y depends on x within/interacting with z).</li>
<li>Use string detection to find out if any of the columns of the data are related to the driving factors in your hypotheses. If you do not have data measured to graphically test a hypothesis, remove it from your list (but keep a record of it). Make sure you still have 1-2 hypotheses left (if you don’t, go back to exercise 1 or go back to the ACS for more data).</li>
<li>Graphically test the remaining hypotheses.</li>
<li>Write a short report outlining following:
<ul>
<li>the hypotheses that you wanted to try but could not (because of lack of data),</li>
<li>comment on if such data could be found at the ZIP code level,</li>
<li>state the hypotheses you could try based on available data,</li>
<li>build the corresponding graphs, and</li>
<li>(briefly) write your explanations of each.</li>
</ul></li>
</ol>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../lessons/lesson12_purrr.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Lesson 12: Functional Iteration with purrr</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../about.html" class="pagination-link">
        <span class="nav-page-text">About</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>